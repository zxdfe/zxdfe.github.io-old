<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>从URL输入到展示 - Zxd's Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="zxd"><meta name=description content="从进程的角度来看 浏览器进程: 主要负责用户交互、子进程管理和文件储存等功能。 网络进程: 面向渲染进程和浏览器进程等提供网络下载功能。 渲染进程: 主"><meta name=keywords content="Hugo,theme,Zxd"><meta name=generator content="Hugo 0.81.0 with theme even"><link rel=canonical href=http://localhost:1313/post/2021-09-17-%E4%BB%8Eurl%E8%BE%93%E5%85%A5%E5%88%B0%E5%B1%95%E7%A4%BA/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><link href=/sass/main.min.8eca1510e0bf04006a123f0d7fcb8799b6e77ab2f264b44357a16e783b064b04.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="从URL输入到展示"><meta property="og:description" content="从进程的角度来看 浏览器进程: 主要负责用户交互、子进程管理和文件储存等功能。 网络进程: 面向渲染进程和浏览器进程等提供网络下载功能。 渲染进程: 主"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/2021-09-17-%E4%BB%8Eurl%E8%BE%93%E5%85%A5%E5%88%B0%E5%B1%95%E7%A4%BA/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-09-17T10:20:34+08:00"><meta property="article:modified_time" content="2021-09-17T10:20:34+08:00"><meta itemprop=name content="从URL输入到展示"><meta itemprop=description content="从进程的角度来看 浏览器进程: 主要负责用户交互、子进程管理和文件储存等功能。 网络进程: 面向渲染进程和浏览器进程等提供网络下载功能。 渲染进程: 主"><meta itemprop=datePublished content="2021-09-17T10:20:34+08:00"><meta itemprop=dateModified content="2021-09-17T10:20:34+08:00"><meta itemprop=wordCount content="2620"><meta itemprop=keywords content=","><meta name=twitter:card content="summary"><meta name=twitter:title content="从URL输入到展示"><meta name=twitter:description content="从进程的角度来看 浏览器进程: 主要负责用户交互、子进程管理和文件储存等功能。 网络进程: 面向渲染进程和浏览器进程等提供网络下载功能。 渲染进程: 主"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>zxd's blog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/vue/><li class=mobile-menu-item>Vue</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>zxd's blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/vue/>Vue</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>从URL输入到展示</h1><div class=post-meta><span class=post-time>2021-09-17</span>
<span class=more-meta>2620 words</span>
<span class=more-meta>6 mins read</span></div></header><div class=post-toc id=post-toc><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#从进程的角度来看>从进程的角度来看</a></li><li><a href=#过程大致如下>过程大致如下</a></li><li><a href=#具体>具体</a><ul><li><a href=#1-用户输入>1. 用户输入</a></li><li><a href=#2-url请求过程>2. URL请求过程</a></li><li><a href=#3-准备渲染进程>3. 准备渲染进程</a></li><li><a href=#4-提交文档>4. 提交文档</a></li><li><a href=#5-渲染阶段>5. 渲染阶段</a></li><li><a href=#总结>总结</a></li><li><a href=#简单版>简单版</a></li></ul></li><li><a href=#w3c标准>W3C标准</a><ul><li><a href=#1最新版本>1.最新版本</a></li><li><a href=#2之前版本>2.之前版本</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=从进程的角度来看>从进程的角度来看</h2><p><img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917102703.png alt></p><ul><li>浏览器进程: 主要负责用户交互、子进程管理和文件储存等功能。</li><li>网络进程: 面向渲染进程和浏览器进程等提供网络下载功能。</li><li>渲染进程: 主要职责是把从网络下载的 HTML、JavaScript、CSS、图片等资源解析为可以显示和交互的页面。</li></ul><h2 id=过程大致如下>过程大致如下</h2><ol><li>首先，浏览器进程接收到用户输入的 URL 请求，浏览器进程便将该 URL 转发给网络进程。</li><li>然后，在网络进程中发起真正的 URL 请求。</li><li>接着网络进程接收到了响应头数据，便解析响应头数据，并将数据转发给浏览器进程。</li><li>浏览器进程接收到网络进程的响应头数据之后，发送“提交导航 (CommitNavigation)”消息到渲染进程；</li><li>渲染进程接收到“提交导航”的消息之后，便开始准备接收 HTML 数据，接收数据的方式是直接和网络进程建立数据管道；</li><li>最后渲染进程会向浏览器进程“确认提交”，这是告诉浏览器进程：“已经准备好接受和解析页面数据了”。</li><li>浏览器进程接收到渲染进程“提交文档”的消息之后，便开始移除之前旧的文档，然后更新浏览器进程中的页面状态。</li></ol><p>其中, <code>用户发出 URL 请求到页面开始解析的这个过程，就叫做导航</code> (对照 NavigationTiming)</p><h2 id=具体>具体</h2><h3 id=1-用户输入>1. 用户输入</h3><p>1.1 用户在地址栏按下回车, 地址栏判断用户输入的内容是<code>搜索内容</code>, 还是<code>请求的URL</code></p><ul><li>搜索内容: 地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的 URL;</li><li>如果判断输入内容符合 URL 规则，比如输入的是baidu.com，那么地址栏会根据规则，把这段内容加上协议，合成为完整的 URL，如 <a href=https://www.baidu.com>https://www.baidu.com</a>。</li></ul><p>当用户输入关键字并键入回车后,如果页面做了<code>beforunload事件</code>监听, 用户可以通过<code>beforeunload</code>事件来取消导航,让浏览器不再执行后续工作</p><p>如果页面没有监听<code>beforeunload事件</code>或者同意了后续流程, tab标签图标进入加载状态;此时页面依旧是之前打开的内容, 并没有立即替换为新页面; 因为需要等待<code>提交文档阶段</code>,页面内容才会被替换;</p><h3 id=2-url请求过程>2. URL请求过程</h3><ol><li><code>浏览器进程</code>会通过<code>进程间通信(IPC)</code>把URL请求发送到<code>网络进程</code>,网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程</li><li>网络进程查找本地资源缓存
首先,网络进程会查找本地缓存是否缓存了该资源。</li></ol><ul><li>如果有缓存资源，那么直接返回资源给浏览器进程；</li><li>如果在缓存中没有查找到资源，那么直接进入网络请求流程.<ul><li>请求前的第一步是要进行 DNS 解析，以获取请求域名的服务器 IP 地址。</li><li>如果请求协议是 HTTPS，那么还需要建立 TLS 连接。</li></ul></li></ul><p>接下来就是利用 IP 地址和服务器建立 TCP 连接。
连接建立之后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的 Cookie 等数据附加到请求头中，然后向服务器发送构建的请求信息。</p><p>服务器接收到请求信息后，会根据请求信息生成响应数据（包括响应行、响应头和响应体等信息），并发给网络进程。等网络进程接收了响应行和响应头之后，就开始解析响应头的内容了。</p><p><strong>重定向</strong></p><p>在接收到服务器返回的响应头后，网络进程开始解析响应头, 如果返回的状态码是 <code>301(Moved Permanently)</code> 或者 <code>302(Temporarily Moved)</code>, 说明服务器需要浏览器重定向到其他 URL。
这时, 网络进程会从响应头的 Location 字段里面读取重定向的地址，然后再发起新的 HTTP 或者 HTTPS 请求 , 一切重新开始.</p><p><code>curl -I + URL</code>命令 : 接收服务器返回的响应头的信息</p><p><img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917112237.png alt>
<img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917112558.png alt></p><p>如果服务器返回的响应头状态码是200, 就可以继续往下处理该请求了.</p><p><strong>响应数据类型处理</strong></p><p><code>Content-Type 是 HTTP 头中一个非常重要的字段， 它告诉浏览器服务器返回的响应体数据是什么类型</code>, 浏览器的<code>Content-Type</code>告诉服务器期望的响应体内容格式, 最终会根据服务器来决定响应体的内容格式.
<img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917113255.png alt>
<img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917113708.png alt></p><p><code>content-type: application/octet-stream</code>告诉浏览器, 返回的是<code>字节流类型</code>, 通常浏览器会按照<code>下载类型</code>来处理;</p><p>所以，不同 Content-Type 的后续处理流程也截然不同。</p><ul><li>如果 Content-Type 字段的值被浏览器判断为下载类型，那么该请求会被提交给浏览器的下载管理器，同时该 URL 请求的导航流程就此结束。</li><li>但如果是 HTML，那么浏览器则会继续进行导航流程。由于 Chrome 的页面渲染是运行在渲染进程中的，所以接下来就需要准备渲染进程了。</li></ul><h3 id=3-准备渲染进程>3. 准备渲染进程</h3><p><strong>同一站点</strong> : <code>根域名(geekbang.org)</code>+<code>协议(https:// https://)</code>,同时包含该根域名下所有子域名和不同端口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>https://time.geekbang.org
https://www.geekbang.org
https://www.geekbang.org:8080
</code></pre></td></tr></table></div></div><p>Chrome 的默认策略是，每个标签对应一个渲染进程。但<strong>如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程</strong>。官方把这个默认策略叫 process-per-site-instance。</p><p>打开一个新页面采用的渲染进程策略就是：</p><ul><li>通常情况下，打开新的页面都会使用单独的渲染进程；</li><li>如果从 A 页面打开 B 页面，且 A 和 B 都属于同一站点的话，那么 B 页面复用 A 页面的渲染进程；如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。</li></ul><p>渲染进程准备好之后，还不能立即进入<code>文档解析状态</code>，因为此时的文档数据还在网络进程中，并没有提交给渲染进程，所以下一步就进入了<code>提交文档阶段</code>。</p><h3 id=4-提交文档>4. 提交文档</h3><p><code>提交文档，就是指浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程</code>, 具体流程是这样的：</p><ul><li>首先当浏览器进程接收到网络进程的响应头数据之后，便向渲染进程发起“提交文档”的消息；</li><li>渲染进程接收到“提交文档”的消息后，会和网络进程建立传输数据的“管道”；</li><li>等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程；</li><li>浏览器进程在收到“确认提交”的消息后，会更新浏览器界面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 Web 页面。</li></ul><p>当渲染进程确认提交之后,更新了如下内容</p><ol><li>更新前进后退状态</li><li>更新安全状态</li><li>更新地址URL</li><li>更新web页面
<img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210917141918.png alt></li></ol><p>到这里，一个完整的导航流程就“走”完了，这之后就要进入渲染阶段了。</p><h3 id=5-渲染阶段>5. 渲染阶段</h3><p>一旦文档被提交，渲染进程便开始页面解析和子资源加载了.</p><p>一旦页面生成完成，渲染进程会发送一个消息给浏览器进程，浏览器接收到消息后，会停止标签图标上的加载动画.</p><h3 id=总结>总结</h3><ol><li>服务器可以根据响应头来控制浏览器的行为，如跳转、网络数据类型判断。</li><li>Chrome 默认采用每个标签对应一个渲染进程，但是如果两个页面属于同一站点，那这两个标签会使用同一个渲染进程。</li><li>浏览器的导航过程涵盖了从用户发起请求到提交文档给渲染进程的中间所有阶段。</li></ol><h3 id=简单版>简单版</h3><ol><li>浏览器地址栏输入 URL 并回车</li><li>浏览器查找当前 URL 是否存在缓存，并比较缓存是否过期</li><li>DNS 解析 URL 对应的 IP</li><li>根据 IP 建立 TCP 连接（三次握手）</li><li>发送 http 请求</li><li>服务器处理请求并返回http报文</li><li>浏览器解析渲染页面</li></ol><h2 id=w3c标准>W3C标准</h2><p><a href=https://www.w3.org/TR/navigation-timing-2/>Navigation Timing Level 2</a></p><h3 id=1最新版本>1.最新版本</h3><p><img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210925090643.png alt></p><h3 id=2之前版本>2.之前版本</h3><p><img src=https://gtd-imgs-md.oss-cn-beijing.aliyuncs.com/imgs/20210925090727.png alt></p><hr><p>PS : 笔记 From GeekTime <code>浏览器工作原理</code></p></div><footer class=post-footer><div class=post-tags><a href=/tags//></a></div><nav class=post-nav><a class=prev href=/post/2021-09-27-c++%E4%BF%AE%E9%A5%B0%E7%AC%A6-%E8%BF%90%E7%AE%97%E7%AC%A6/><i class="fa fa-long-arrow-left"></i><span class="prev-text nav-default">C++ 修饰符 运算符</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2021-09-06-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/><span class="next-text nav-default">进程/线程 浏览器架构</span>
<span class="next-text nav-mobile">Next</span>
<i class="fa fa-long-arrow-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2020 -
2021<span class=heart>
<i class="fa fa-heartbeat"></i></span><span class=z-author>zxd</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script><script>if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));else{const a=document.createElement("style"),b=`
                    @media screen and (min-width: 750px){
                            img[src*="#w90"] {
                            width: 90% !important;
                            }
                            
                            img[src*="#w80"] {
                            width: 80% !important;
                            }
                            
                            img[src*="#w70"] {
                            width: 70% !important;
                            }
                            
                            img[src*="#w60"] {
                            width: 60% !important;
                            }
                            
                            img[src*="#w50"] {
                            width: 50% !important;
                            }
                            
                            img[src*="#w40"] {
                            width: 40% !important;
                            }
                            img[src*="#w30"] {
                            width: 30% !important;
                            }
                        }
                    `;try{a.appendChild(document.createTextNode(b))}catch(c){a.styleSheet.cssText=b}document.getElementsByTagName("head")[0].appendChild(a)}</script></body></html>